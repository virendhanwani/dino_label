{"ast":null,"code":"var __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n    return t;\n  };\n  return __assign.apply(this, arguments);\n};\nimport { CRUD_GET_MANY_REFERENCE_SUCCESS } from '../../../actions';\nimport { DELETE, DELETE_MANY } from '../../../core';\nvar initialState = {};\nvar oneToManyReducer = function (previousState, action) {\n  var _a;\n  if (previousState === void 0) {\n    previousState = initialState;\n  }\n  if (action.meta && action.meta.optimistic) {\n    var relatedTo = getRelatedReferences(previousState, action.meta.resource);\n    if (action.meta.fetch === DELETE) {\n      return relatedTo.reduce(removeDeletedReferences([action.payload.id]), previousState);\n    }\n    if (action.meta.fetch === DELETE_MANY) {\n      return relatedTo.reduce(removeDeletedReferences(action.payload.ids), previousState);\n    }\n  }\n  switch (action.type) {\n    case CRUD_GET_MANY_REFERENCE_SUCCESS:\n      return __assign(__assign({}, previousState), (_a = {}, _a[action.meta.relatedTo] = {\n        ids: action.payload.data.map(function (record) {\n          return record.id;\n        }),\n        total: action.payload.total\n      }, _a));\n    default:\n      return previousState;\n  }\n};\nexport var getIds = function (state, relatedTo) {\n  return state.admin.references.oneToMany[relatedTo] && state.admin.references.oneToMany[relatedTo].ids;\n};\nexport var getTotal = function (state, relatedTo) {\n  return state.admin.references.oneToMany[relatedTo] && state.admin.references.oneToMany[relatedTo].total;\n};\nexport var getReferences = function (state, reference, relatedTo) {\n  var ids = getIds(state, relatedTo);\n  if (typeof ids === 'undefined') {\n    return undefined;\n  }\n  if (!state.admin.resources[reference]) {\n    // eslint-disable-next-line no-console\n    console.error(\"Invalid Resource \\\"\" + reference + \"\\\"\\n\" + (\"You are trying to display or edit a field of a resource called \\\"\" + reference + \"\\\", \") + 'but it has not been declared.\\n' + \"Declare this resource in the Admin or check the 'reference' prop of ReferenceArrayField and ReferenceManyField.\", {\n      ids: ids\n    });\n  }\n  return ids.map(function (id) {\n    var resource = state.admin.resources[reference];\n    if (!resource) {\n      return undefined;\n    }\n    return resource.data[id];\n  }).filter(function (r) {\n    return typeof r !== 'undefined';\n  }).reduce(function (prev, record) {\n    prev[record.id] = record; // eslint-disable-line no-param-reassign\n    return prev;\n  }, {});\n};\nexport var getReferencesByIds = function (state, reference, ids) {\n  if (ids.length === 0) {\n    return {};\n  }\n  if (!state.admin.resources[reference]) {\n    // eslint-disable-next-line no-console\n    console.error(\"Invalid Resource \\\"\" + reference + \"\\\"\\n\" + (\"You are trying to display or edit a field of a resource called \\\"\" + reference + \"\\\", \") + 'but it has not been declared.\\n' + \"Declare this resource in the Admin or check the 'reference' prop of ReferenceArrayField.\", {\n      ids: ids\n    });\n  }\n  var references = ids.map(function (id) {\n    var resource = state.admin.resources[reference];\n    if (!resource) {\n      return undefined;\n    }\n    return resource.data[id];\n  }).filter(function (r) {\n    return typeof r !== 'undefined';\n  }).reduce(function (prev, record) {\n    prev[record.id] = record; // eslint-disable-line no-param-reassign\n    return prev;\n  }, {});\n  return Object.keys(references).length > 0 ? references : null;\n};\nvar getRelatedReferences = function (previousState, resource) {\n  return Object.keys(previousState).filter(function (key) {\n    return key.includes(resource);\n  });\n};\nvar removeDeletedReferences = function (removedIds) {\n  return function (previousState, key) {\n    var _a;\n    var idsToKeep = previousState[key].ids.filter(function (id) {\n      return !removedIds.includes(id);\n    });\n    if (idsToKeep.length === previousState[key].ids.length) {\n      return previousState;\n    }\n    return __assign(__assign({}, previousState), (_a = {}, _a[key] = {\n      ids: idsToKeep,\n      total: idsToKeep.length\n    }, _a));\n  };\n};\nexport var nameRelatedTo = function (reference, id, resource, target, filter) {\n  if (filter === void 0) {\n    filter = {};\n  }\n  var keys = Object.keys(filter);\n  if (!keys.length) {\n    return resource + \"_\" + reference + \"@\" + target + \"_\" + id;\n  }\n  return resource + \"_\" + reference + \"@\" + target + \"_\" + id + \"?\" + keys.map(function (key) {\n    return key + \"=\" + JSON.stringify(filter[key]);\n  }).join('&');\n};\nexport default oneToManyReducer;","map":{"version":3,"names":["__assign","Object","assign","t","s","i","n","arguments","length","p","prototype","hasOwnProperty","call","apply","CRUD_GET_MANY_REFERENCE_SUCCESS","DELETE","DELETE_MANY","initialState","oneToManyReducer","previousState","action","_a","meta","optimistic","relatedTo","getRelatedReferences","resource","fetch","reduce","removeDeletedReferences","payload","id","ids","type","data","map","record","total","getIds","state","admin","references","oneToMany","getTotal","getReferences","reference","undefined","resources","console","error","filter","r","prev","getReferencesByIds","keys","key","includes","removedIds","idsToKeep","nameRelatedTo","target","JSON","stringify","join"],"sources":["/node_modules/ra-core/esm/reducer/admin/references/oneToMany.js"],"sourcesContent":["var __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nimport { CRUD_GET_MANY_REFERENCE_SUCCESS, } from '../../../actions';\nimport { DELETE, DELETE_MANY } from '../../../core';\nvar initialState = {};\nvar oneToManyReducer = function (previousState, action) {\n    var _a;\n    if (previousState === void 0) { previousState = initialState; }\n    if (action.meta && action.meta.optimistic) {\n        var relatedTo = getRelatedReferences(previousState, action.meta.resource);\n        if (action.meta.fetch === DELETE) {\n            return relatedTo.reduce(removeDeletedReferences([action.payload.id]), previousState);\n        }\n        if (action.meta.fetch === DELETE_MANY) {\n            return relatedTo.reduce(removeDeletedReferences(action.payload.ids), previousState);\n        }\n    }\n    switch (action.type) {\n        case CRUD_GET_MANY_REFERENCE_SUCCESS:\n            return __assign(__assign({}, previousState), (_a = {}, _a[action.meta.relatedTo] = {\n                ids: action.payload.data.map(function (record) { return record.id; }),\n                total: action.payload.total,\n            }, _a));\n        default:\n            return previousState;\n    }\n};\nexport var getIds = function (state, relatedTo) {\n    return state.admin.references.oneToMany[relatedTo] &&\n        state.admin.references.oneToMany[relatedTo].ids;\n};\nexport var getTotal = function (state, relatedTo) {\n    return state.admin.references.oneToMany[relatedTo] &&\n        state.admin.references.oneToMany[relatedTo].total;\n};\nexport var getReferences = function (state, reference, relatedTo) {\n    var ids = getIds(state, relatedTo);\n    if (typeof ids === 'undefined') {\n        return undefined;\n    }\n    if (!state.admin.resources[reference]) {\n        // eslint-disable-next-line no-console\n        console.error(\"Invalid Resource \\\"\" + reference + \"\\\"\\n\" +\n            (\"You are trying to display or edit a field of a resource called \\\"\" + reference + \"\\\", \") +\n            'but it has not been declared.\\n' +\n            \"Declare this resource in the Admin or check the 'reference' prop of ReferenceArrayField and ReferenceManyField.\", { ids: ids });\n    }\n    return ids\n        .map(function (id) {\n        var resource = state.admin.resources[reference];\n        if (!resource) {\n            return undefined;\n        }\n        return resource.data[id];\n    })\n        .filter(function (r) { return typeof r !== 'undefined'; })\n        .reduce(function (prev, record) {\n        prev[record.id] = record; // eslint-disable-line no-param-reassign\n        return prev;\n    }, {});\n};\nexport var getReferencesByIds = function (state, reference, ids) {\n    if (ids.length === 0) {\n        return {};\n    }\n    if (!state.admin.resources[reference]) {\n        // eslint-disable-next-line no-console\n        console.error(\"Invalid Resource \\\"\" + reference + \"\\\"\\n\" +\n            (\"You are trying to display or edit a field of a resource called \\\"\" + reference + \"\\\", \") +\n            'but it has not been declared.\\n' +\n            \"Declare this resource in the Admin or check the 'reference' prop of ReferenceArrayField.\", { ids: ids });\n    }\n    var references = ids\n        .map(function (id) {\n        var resource = state.admin.resources[reference];\n        if (!resource) {\n            return undefined;\n        }\n        return resource.data[id];\n    })\n        .filter(function (r) { return typeof r !== 'undefined'; })\n        .reduce(function (prev, record) {\n        prev[record.id] = record; // eslint-disable-line no-param-reassign\n        return prev;\n    }, {});\n    return Object.keys(references).length > 0 ? references : null;\n};\nvar getRelatedReferences = function (previousState, resource) { return Object.keys(previousState).filter(function (key) { return key.includes(resource); }); };\nvar removeDeletedReferences = function (removedIds) { return function (previousState, key) {\n    var _a;\n    var idsToKeep = previousState[key].ids.filter(function (id) { return !removedIds.includes(id); });\n    if (idsToKeep.length === previousState[key].ids.length) {\n        return previousState;\n    }\n    return __assign(__assign({}, previousState), (_a = {}, _a[key] = {\n        ids: idsToKeep,\n        total: idsToKeep.length,\n    }, _a));\n}; };\nexport var nameRelatedTo = function (reference, id, resource, target, filter) {\n    if (filter === void 0) { filter = {}; }\n    var keys = Object.keys(filter);\n    if (!keys.length) {\n        return resource + \"_\" + reference + \"@\" + target + \"_\" + id;\n    }\n    return resource + \"_\" + reference + \"@\" + target + \"_\" + id + \"?\" + keys\n        .map(function (key) { return key + \"=\" + JSON.stringify(filter[key]); })\n        .join('&');\n};\nexport default oneToManyReducer;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}