{"ast":null,"code":"import { useCallback } from 'react';\n// @ts-ignore\nimport { parse } from 'query-string';\nimport { useLocation } from 'react-router-dom';\nimport { useCheckMinimumRequiredProps } from '../checkMinimumRequiredProps';\nimport { useCreate } from '../../dataProvider';\nimport { useNotify, useRedirect } from '../../sideEffect';\nimport { useSaveModifiers } from '../saveModifiers';\nimport { useTranslate } from '../../i18n';\nimport useVersion from '../useVersion';\nimport { CRUD_CREATE } from '../../actions';\nimport { useResourceContext, useGetResourceLabel } from '../../core';\n/**\n * Prepare data for the Create view\n *\n * @param {Object} props The props passed to the Create component.\n *\n * @return {Object} controllerProps Fetched data and callbacks for the Create view\n *\n * @example\n *\n * import { useCreateController } from 'react-admin';\n * import CreateView from './CreateView';\n *\n * const MyCreate = props => {\n *     const controllerProps = useCreateController(props);\n *     return <CreateView {...controllerProps} {...props} />;\n * }\n */\nexport var useCreateController = function (props) {\n  useCheckMinimumRequiredProps('Create', ['basePath', 'resource'], props);\n  var basePath = props.basePath,\n    hasEdit = props.hasEdit,\n    hasShow = props.hasShow,\n    _a = props.record,\n    record = _a === void 0 ? {} : _a,\n    successMessage = props.successMessage,\n    onSuccess = props.onSuccess,\n    onFailure = props.onFailure,\n    transform = props.transform;\n  var resource = useResourceContext(props);\n  var location = useLocation();\n  var translate = useTranslate();\n  var notify = useNotify();\n  var redirect = useRedirect();\n  var recordToUse = getRecord(location, record);\n  var version = useVersion();\n  if (process.env.NODE_ENV !== 'production' && successMessage) {\n    console.log('<Create successMessage> prop is deprecated, use the onSuccess prop instead.');\n  }\n  var _b = useSaveModifiers({\n      onSuccess: onSuccess,\n      onFailure: onFailure,\n      transform: transform\n    }),\n    onSuccessRef = _b.onSuccessRef,\n    setOnSuccess = _b.setOnSuccess,\n    onFailureRef = _b.onFailureRef,\n    setOnFailure = _b.setOnFailure,\n    transformRef = _b.transformRef,\n    setTransform = _b.setTransform;\n  var _c = useCreate(resource),\n    create = _c[0],\n    saving = _c[1].loading;\n  var save = useCallback(function (data, redirectTo, _a) {\n    if (redirectTo === void 0) {\n      redirectTo = 'list';\n    }\n    var _b = _a === void 0 ? {} : _a,\n      onSuccessFromSave = _b.onSuccess,\n      onFailureFromSave = _b.onFailure,\n      transformFromSave = _b.transform;\n    return Promise.resolve(transformFromSave ? transformFromSave(data) : transformRef.current ? transformRef.current(data) : data).then(function (data) {\n      return create({\n        payload: {\n          data: data\n        }\n      }, {\n        action: CRUD_CREATE,\n        onSuccess: onSuccessFromSave ? onSuccessFromSave : onSuccessRef.current ? onSuccessRef.current : function (_a) {\n          var newRecord = _a.data;\n          notify(successMessage || 'ra.notification.created', {\n            type: 'info',\n            messageArgs: {\n              smart_count: 1\n            }\n          });\n          redirect(redirectTo, basePath, newRecord.id, newRecord);\n        },\n        onFailure: onFailureFromSave ? onFailureFromSave : onFailureRef.current ? onFailureRef.current : function (error) {\n          notify(typeof error === 'string' ? error : error.message || 'ra.notification.http_error', {\n            type: 'warning',\n            messageArgs: {\n              _: typeof error === 'string' ? error : error && error.message ? error.message : undefined\n            }\n          });\n        }\n      });\n    });\n  }, [transformRef, create, onSuccessRef, onFailureRef, notify, successMessage, redirect, basePath]);\n  var getResourceLabel = useGetResourceLabel();\n  var defaultTitle = translate('ra.page.create', {\n    name: getResourceLabel(resource, 1)\n  });\n  return {\n    loading: false,\n    loaded: true,\n    saving: saving,\n    defaultTitle: defaultTitle,\n    onFailureRef: onFailureRef,\n    onSuccessRef: onSuccessRef,\n    transformRef: transformRef,\n    save: save,\n    setOnSuccess: setOnSuccess,\n    setOnFailure: setOnFailure,\n    setTransform: setTransform,\n    resource: resource,\n    basePath: basePath,\n    record: recordToUse,\n    redirect: getDefaultRedirectRoute(hasShow, hasEdit),\n    version: version\n  };\n};\nexport var getRecord = function (_a, record) {\n  var state = _a.state,\n    search = _a.search;\n  if (record === void 0) {\n    record = {};\n  }\n  if (state && state.record) {\n    return state.record;\n  }\n  if (search) {\n    try {\n      var searchParams = parse(search);\n      if (searchParams.source) {\n        if (Array.isArray(searchParams.source)) {\n          console.error(\"Failed to parse location search parameter '\" + search + \"'. To pre-fill some fields in the Create form, pass a stringified source parameter (e.g. '?source={\\\"title\\\":\\\"foo\\\"}')\");\n          return;\n        }\n        return JSON.parse(searchParams.source);\n      }\n    } catch (e) {\n      console.error(\"Failed to parse location search parameter '\" + search + \"'. To pre-fill some fields in the Create form, pass a stringified source parameter (e.g. '?source={\\\"title\\\":\\\"foo\\\"}')\");\n    }\n  }\n  return record;\n};\nvar getDefaultRedirectRoute = function (hasShow, hasEdit) {\n  if (hasEdit) {\n    return 'edit';\n  }\n  if (hasShow) {\n    return 'show';\n  }\n  return 'list';\n};","map":{"version":3,"names":["useCallback","parse","useLocation","useCheckMinimumRequiredProps","useCreate","useNotify","useRedirect","useSaveModifiers","useTranslate","useVersion","CRUD_CREATE","useResourceContext","useGetResourceLabel","useCreateController","props","basePath","hasEdit","hasShow","_a","record","successMessage","onSuccess","onFailure","transform","resource","location","translate","notify","redirect","recordToUse","getRecord","version","process","env","NODE_ENV","console","log","_b","onSuccessRef","setOnSuccess","onFailureRef","setOnFailure","transformRef","setTransform","_c","create","saving","loading","save","data","redirectTo","onSuccessFromSave","onFailureFromSave","transformFromSave","Promise","resolve","current","then","payload","action","newRecord","type","messageArgs","smart_count","id","error","message","_","undefined","getResourceLabel","defaultTitle","name","loaded","getDefaultRedirectRoute","state","search","searchParams","source","Array","isArray","JSON","e"],"sources":["/node_modules/ra-core/esm/controller/details/useCreateController.js"],"sourcesContent":["import { useCallback } from 'react';\n// @ts-ignore\nimport { parse } from 'query-string';\nimport { useLocation } from 'react-router-dom';\nimport { useCheckMinimumRequiredProps } from '../checkMinimumRequiredProps';\nimport { useCreate } from '../../dataProvider';\nimport { useNotify, useRedirect, } from '../../sideEffect';\nimport { useSaveModifiers, } from '../saveModifiers';\nimport { useTranslate } from '../../i18n';\nimport useVersion from '../useVersion';\nimport { CRUD_CREATE } from '../../actions';\nimport { useResourceContext, useGetResourceLabel } from '../../core';\n/**\n * Prepare data for the Create view\n *\n * @param {Object} props The props passed to the Create component.\n *\n * @return {Object} controllerProps Fetched data and callbacks for the Create view\n *\n * @example\n *\n * import { useCreateController } from 'react-admin';\n * import CreateView from './CreateView';\n *\n * const MyCreate = props => {\n *     const controllerProps = useCreateController(props);\n *     return <CreateView {...controllerProps} {...props} />;\n * }\n */\nexport var useCreateController = function (props) {\n    useCheckMinimumRequiredProps('Create', ['basePath', 'resource'], props);\n    var basePath = props.basePath, hasEdit = props.hasEdit, hasShow = props.hasShow, _a = props.record, record = _a === void 0 ? {} : _a, successMessage = props.successMessage, onSuccess = props.onSuccess, onFailure = props.onFailure, transform = props.transform;\n    var resource = useResourceContext(props);\n    var location = useLocation();\n    var translate = useTranslate();\n    var notify = useNotify();\n    var redirect = useRedirect();\n    var recordToUse = getRecord(location, record);\n    var version = useVersion();\n    if (process.env.NODE_ENV !== 'production' && successMessage) {\n        console.log('<Create successMessage> prop is deprecated, use the onSuccess prop instead.');\n    }\n    var _b = useSaveModifiers({ onSuccess: onSuccess, onFailure: onFailure, transform: transform }), onSuccessRef = _b.onSuccessRef, setOnSuccess = _b.setOnSuccess, onFailureRef = _b.onFailureRef, setOnFailure = _b.setOnFailure, transformRef = _b.transformRef, setTransform = _b.setTransform;\n    var _c = useCreate(resource), create = _c[0], saving = _c[1].loading;\n    var save = useCallback(function (data, redirectTo, _a) {\n        if (redirectTo === void 0) { redirectTo = 'list'; }\n        var _b = _a === void 0 ? {} : _a, onSuccessFromSave = _b.onSuccess, onFailureFromSave = _b.onFailure, transformFromSave = _b.transform;\n        return Promise.resolve(transformFromSave\n            ? transformFromSave(data)\n            : transformRef.current\n                ? transformRef.current(data)\n                : data).then(function (data) {\n            return create({ payload: { data: data } }, {\n                action: CRUD_CREATE,\n                onSuccess: onSuccessFromSave\n                    ? onSuccessFromSave\n                    : onSuccessRef.current\n                        ? onSuccessRef.current\n                        : function (_a) {\n                            var newRecord = _a.data;\n                            notify(successMessage ||\n                                'ra.notification.created', {\n                                type: 'info',\n                                messageArgs: { smart_count: 1 },\n                            });\n                            redirect(redirectTo, basePath, newRecord.id, newRecord);\n                        },\n                onFailure: onFailureFromSave\n                    ? onFailureFromSave\n                    : onFailureRef.current\n                        ? onFailureRef.current\n                        : function (error) {\n                            notify(typeof error === 'string'\n                                ? error\n                                : error.message ||\n                                    'ra.notification.http_error', {\n                                type: 'warning',\n                                messageArgs: {\n                                    _: typeof error === 'string'\n                                        ? error\n                                        : error && error.message\n                                            ? error.message\n                                            : undefined,\n                                },\n                            });\n                        },\n            });\n        });\n    }, [\n        transformRef,\n        create,\n        onSuccessRef,\n        onFailureRef,\n        notify,\n        successMessage,\n        redirect,\n        basePath,\n    ]);\n    var getResourceLabel = useGetResourceLabel();\n    var defaultTitle = translate('ra.page.create', {\n        name: getResourceLabel(resource, 1),\n    });\n    return {\n        loading: false,\n        loaded: true,\n        saving: saving,\n        defaultTitle: defaultTitle,\n        onFailureRef: onFailureRef,\n        onSuccessRef: onSuccessRef,\n        transformRef: transformRef,\n        save: save,\n        setOnSuccess: setOnSuccess,\n        setOnFailure: setOnFailure,\n        setTransform: setTransform,\n        resource: resource,\n        basePath: basePath,\n        record: recordToUse,\n        redirect: getDefaultRedirectRoute(hasShow, hasEdit),\n        version: version,\n    };\n};\nexport var getRecord = function (_a, record) {\n    var state = _a.state, search = _a.search;\n    if (record === void 0) { record = {}; }\n    if (state && state.record) {\n        return state.record;\n    }\n    if (search) {\n        try {\n            var searchParams = parse(search);\n            if (searchParams.source) {\n                if (Array.isArray(searchParams.source)) {\n                    console.error(\"Failed to parse location search parameter '\" + search + \"'. To pre-fill some fields in the Create form, pass a stringified source parameter (e.g. '?source={\\\"title\\\":\\\"foo\\\"}')\");\n                    return;\n                }\n                return JSON.parse(searchParams.source);\n            }\n        }\n        catch (e) {\n            console.error(\"Failed to parse location search parameter '\" + search + \"'. To pre-fill some fields in the Create form, pass a stringified source parameter (e.g. '?source={\\\"title\\\":\\\"foo\\\"}')\");\n        }\n    }\n    return record;\n};\nvar getDefaultRedirectRoute = function (hasShow, hasEdit) {\n    if (hasEdit) {\n        return 'edit';\n    }\n    if (hasShow) {\n        return 'show';\n    }\n    return 'list';\n};\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}